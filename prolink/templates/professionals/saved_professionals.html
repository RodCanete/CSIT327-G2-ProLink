<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Saved Professionals - PROLINK</title>
    {% load static %}
    <link rel="stylesheet" href="{% static 'css/dashboard.css' %}?v=3">
    <link rel="stylesheet" href="{% static 'css/professionals.css' %}?v=1">
    <link rel="stylesheet" href="{% static 'css/saved_professionals.css' %}?v=1">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body class="saved-page">
    {% include 'components/navbar.html' %}

    <main class="main-content">
        <div class="professionals-container">
            <div class="page-header">
                <div class="page-title">
                    <h1>Saved Professionals</h1>
                    <p>Your saved professionals for quick access</p>
                </div>
            </div>

            {% if saved_professionals %}
                <div class="professionals-grid">
                    {% for saved in saved_professionals %}
                        {% with professional=saved.professional %}
                        <div class="professional-card" data-professional-id="{{ professional.id }}">
                            <div class="professional-header">
                                <div class="professional-avatar-large">
                                    <img src="{{ professional.user.get_profile_picture }}" alt="{{ professional.user.get_full_name }}">
                                    {% if professional.is_verified %}
                                    <span class="verified-badge" title="Verified Professional">
                                        <i class="fas fa-check-circle"></i>
                                    </span>
                                    {% endif %}
                                </div>
                                <div class="professional-basic-info">
                                    <h3>{{ professional.user.get_full_name|default:professional.user.username }}</h3>
                                    <div class="professional-specializations">
                                        {% for spec in professional.specializations.all|slice:":3" %}
                                        <span class="specialization-tag">{{ spec.name }}</span>
                                        {% endfor %}
                                    </div>
                                    <div class="professional-rating">
                                        <div class="stars">
                                            {% for i in "12345" %}
                                                {% if forloop.counter <= professional.average_rating %}
                                                <i class="fas fa-star"></i>
                                                {% elif forloop.counter <= professional.average_rating|add:"0.5" %}
                                                <i class="fas fa-star-half-alt"></i>
                                                {% else %}
                                                <i class="far fa-star"></i>
                                                {% endif %}
                                            {% endfor %}
                                        </div>
                                        <span class="rating-text">{{ professional.average_rating|floatformat:1 }} ({{ professional.total_reviews }} review{{ professional.total_reviews|pluralize }})</span>
                                    </div>
                                </div>
                                <button class="save-btn saved" 
                                        data-professional-id="{{ professional.id }}"
                                        title="Remove from saved"
                                        onclick="unsaveProfessional({{ professional.id }})">
                                    <i class="fas fa-bookmark"></i>
                                </button>
                            </div>

                            <div class="professional-body">
                                <div class="professional-bio">
                                    <p>{{ professional.user.bio|truncatewords:30|default:"No bio available." }}</p>
                                </div>

                                <div class="professional-stats">
                                    <div class="stat-item">
                                        <i class="fas fa-briefcase"></i>
                                        <span>{{ professional.get_experience_level_display }}</span>
                                    </div>
                                    <div class="stat-item">
                                        <i class="fas fa-clock"></i>
                                        <span>{{ professional.years_of_experience }} years</span>
                                    </div>
                                    <div class="stat-item">
                                        <i class="fas fa-check-double"></i>
                                        <span>{{ professional.completed_consultations }} completed</span>
                                    </div>
                                    {% if professional.is_available %}
                                    <div class="stat-item available">
                                        <i class="fas fa-circle"></i>
                                        <span>Available</span>
                                    </div>
                                    {% endif %}
                                </div>

                                <div class="professional-pricing">
                                    <div class="price-info">
                                        <span class="price-label">Hourly Rate:</span>
                                        <span class="price-value">${{ professional.hourly_rate|floatformat:0 }}/hr</span>
                                    </div>
                                    {% if professional.consultation_fee > 0 %}
                                    <div class="price-info">
                                        <span class="price-label">Consultation:</span>
                                        <span class="price-value">${{ professional.consultation_fee|floatformat:0 }}</span>
                                    </div>
                                    {% endif %}
                                </div>
                            </div>

                            <div class="professional-footer">
                                <a href="{% url 'professional_detail' professional.id %}" class="btn btn-outline btn-sm">
                                    <i class="fas fa-user"></i>
                                    View Profile
                                </a>
                                <a href="{% url 'create_request' %}?professional={{ professional.id }}" class="btn btn-primary btn-sm">
                                    <i class="fas fa-paper-plane"></i>
                                    Request Consultation
                                </a>
                            </div>
                        </div>
                        {% endwith %}
                    {% endfor %}
                </div>
            {% else %}
                <div class="empty-state">
                    <i class="far fa-bookmark"></i>
                    <h2>No Saved Professionals Yet</h2>
                    <p>Start saving professionals you're interested in for quick access later</p>
                    <a href="{% url 'find_professionals' %}" class="btn btn-primary">
                        <i class="fas fa-search"></i> Browse Professionals
                    </a>
                </div>
            {% endif %}
        </div>
    </main>

    <script>
        // CSRF helper for AJAX
        function getCookie(name) {
            const value = `; ${document.cookie}`;
            const parts = value.split(`; ${name}=`);
            if (parts.length === 2) return parts.pop().split(';').shift();
        }
        function unsaveProfessional(professionalId) {
            fetch(`/professionals/${professionalId}/unsave/`, {
                method: 'POST',
                headers: {
                    'X-CSRFToken': getCookie('csrftoken'),
                    'Content-Type': 'application/json',
                },
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    window.location.reload();
                } else {
                    alert(data.message || 'Failed to unsave professional');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('An error occurred');
            });
        }
    </script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</body>
</html>
