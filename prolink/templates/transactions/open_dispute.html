{% extends "base.html" %}
{% load static %}

{% block title %}Open Dispute - ProLink{% endblock %}

{% block extra_css %}
<style>
    .dispute-container {
        max-width: 900px;
        margin: 40px auto;
        padding: 20px;
    }
    
    .dispute-card {
        background: white;
        border-radius: 15px;
        padding: 30px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    
    .dispute-header {
        text-align: center;
        padding: 30px;
        background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        color: white;
        border-radius: 15px;
        margin-bottom: 30px;
    }
    
    .dispute-header h2 {
        color: white;
        margin-bottom: 10px;
    }
    
    .warning-box {
        background: #fff3cd;
        border-left: 4px solid #ffc107;
        padding: 20px;
        border-radius: 8px;
        margin: 20px 0;
    }
    
    .warning-box h4 {
        color: #856404;
        margin-bottom: 10px;
    }
    
    .info-section {
        background: #f8f9fa;
        padding: 20px;
        border-radius: 10px;
        margin: 20px 0;
    }
    
    .info-section h4 {
        color: #2c3e50;
        margin-bottom: 15px;
    }
    
    .form-group {
        margin-bottom: 25px;
    }
    
    .form-group label {
        display: block;
        font-weight: 600;
        color: #2c3e50;
        margin-bottom: 10px;
        font-size: 16px;
    }
    
    .form-group textarea,
    .form-group input[type="file"] {
        width: 100%;
        padding: 15px;
        border: 2px solid #e0e0e0;
        border-radius: 10px;
        font-size: 15px;
        font-family: inherit;
    }
    
    .form-group textarea {
        resize: vertical;
    }
    
    .form-group textarea:focus {
        outline: none;
        border-color: #667eea;
    }
    
    .file-upload-area {
        border: 2px dashed #ccc;
        border-radius: 10px;
        padding: 30px;
        text-align: center;
        background: #f8f9fa;
        cursor: pointer;
        transition: all 0.3s;
    }
    
    .file-upload-area:hover {
        border-color: #667eea;
        background: #e3f2fd;
    }
    
    .file-upload-area i {
        font-size: 48px;
        color: #667eea;
        margin-bottom: 15px;
    }
    
    .action-buttons {
        display: flex;
        gap: 15px;
        margin-top: 30px;
    }
    
    .btn-submit-dispute {
        flex: 1;
        background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        color: white;
        border: none;
        padding: 15px;
        border-radius: 10px;
        font-size: 18px;
        font-weight: 600;
        cursor: pointer;
        transition: transform 0.2s;
    }
    
    .btn-submit-dispute:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(245, 87, 108, 0.3);
    }
    
    .btn-cancel {
        flex: 1;
        background: #e0e0e0;
        color: #666;
        border: none;
        padding: 15px;
        border-radius: 10px;
        font-size: 18px;
        font-weight: 600;
        cursor: pointer;
        text-decoration: none;
        display: flex;
        align-items: center;
        justify-content: center;
    }
</style>
{% endblock %}

{% block content %}
<div class="dispute-container">
    <div class="dispute-card">
        <div class="dispute-header">
            <h2><i class="fas fa-gavel"></i> Open a Dispute</h2>
            <p style="margin: 0;">Request: {{ service_request.title }}</p>
        </div>

        <div class="warning-box">
            <h4><i class="fas fa-exclamation-triangle"></i> Important Notice</h4>
            <ul style="margin: 10px 0 0 20px;">
                <li>Opening a dispute will freeze the transaction immediately</li>
                <li>An administrator will review your case within 24-48 hours</li>
                <li>Provide detailed evidence to support your claim</li>
                <li>The admin's decision is final</li>
                <li>Possible outcomes: Full refund to you OR Full payment to professional</li>
            </ul>
        </div>

        <div class="info-section">
            <h4><i class="fas fa-info-circle"></i> Transaction Details</h4>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                <div>
                    <strong>Professional:</strong><br>
                    {{ service_request.professional }}
                </div>
                <div>
                    <strong>Amount:</strong><br>
                    â‚±{{ transaction.amount|floatformat:2 }}
                </div>
                <div>
                    <strong>Status:</strong><br>
                    {{ transaction.get_status_display }}
                </div>
                <div>
                    <strong>Payment Date:</strong><br>
                    {{ transaction.paid_at|date:"M d, Y" }}
                </div>
            </div>
        </div>

        <form method="POST" enctype="multipart/form-data" id="disputeForm">
            {% csrf_token %}
            
            <div class="form-group">
                <label for="reason">
                    <i class="fas fa-clipboard-list"></i> Reason for Dispute *
                    <small style="font-weight: normal; color: #666;">(Minimum 50 characters)</small>
                </label>
                <textarea 
                    name="reason" 
                    id="reason" 
                    rows="6" 
                    required 
                    minlength="50"
                    placeholder="Please provide a detailed explanation of why you're opening this dispute...&#10;&#10;Examples:&#10;- Work does not match the requirements&#10;- Professional not responding to revision requests&#10;- Quality is significantly below expectations&#10;- Deliverables are incomplete or missing"
                ></textarea>
            </div>

            <div class="form-group">
                <label for="client_evidence">
                    <i class="fas fa-file-alt"></i> Additional Evidence
                    <small style="font-weight: normal; color: #666;">(Optional - provide more context)</small>
                </label>
                <textarea 
                    name="client_evidence" 
                    id="client_evidence" 
                    rows="4"
                    placeholder="Additional details, timeline of events, previous communication, etc."
                ></textarea>
            </div>

            <div class="form-group">
                <label>
                    <i class="fas fa-paperclip"></i> Upload Evidence Files
                    <small style="font-weight: normal; color: #666;">(Optional - screenshots, documents, etc.)</small>
                </label>
                <div class="file-upload-area" onclick="document.getElementById('evidence_files').click()">
                    <i class="fas fa-cloud-upload-alt"></i>
                    <p style="margin: 0;"><strong>Click to upload files</strong></p>
                    <p style="margin: 5px 0 0 0; color: #666;">PDF, PNG, JPG, DOC (Max 10MB each)</p>
                </div>
                <input 
                    type="file" 
                    name="evidence_files" 
                    id="evidence_files" 
                    multiple 
                    accept=".pdf,.png,.jpg,.jpeg,.doc,.docx"
                    style="display: none;"
                    onchange="showFileNames()"
                >
                <div id="fileNames" style="margin-top: 10px; color: #666; font-size: 14px;"></div>
            </div>

            <div class="warning-box">
                <h4><i class="fas fa-check-circle"></i> Before Submitting</h4>
                <ul style="margin: 10px 0 0 20px;">
                    <li>Have you tried requesting revisions? (You can request up to {{ service_request.max_revisions }})</li>
                    <li>Have you communicated clearly with the professional?</li>
                    <li>Do you have sufficient evidence to support your claim?</li>
                    <li>Are you prepared for the dispute process (24-48 hours)?</li>
                </ul>
            </div>

            <div class="action-buttons">
                <a href="{% url 'requests:request_detail' service_request.id %}" class="btn-cancel">
                    <i class="fas fa-times"></i> Cancel
                </a>
                <button type="submit" class="btn-submit-dispute" onclick="return confirm('Are you sure you want to open a dispute? This action cannot be undone.')">
                    <i class="fas fa-gavel"></i> Open Dispute
                </button>
            </div>
        </form>
    </div>
</div>

<script>
function showFileNames() {
    const input = document.getElementById('evidence_files');
    const fileNamesDiv = document.getElementById('fileNames');
    
    if (input.files.length > 0) {
        const fileList = Array.from(input.files).map(f => `ðŸ“Ž ${f.name}`).join('<br>');
        fileNamesDiv.innerHTML = `<strong>Selected files:</strong><br>${fileList}`;
    } else {
        fileNamesDiv.innerHTML = '';
    }
}
</script>
{% endblock %}
