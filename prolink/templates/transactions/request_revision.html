{% extends "base.html" %}
{% load static %}

{% block title %}Request Revision - ProLink{% endblock %}

{% block extra_css %}
<style>
    .revision-container {
        max-width: 800px;
        margin: 40px auto;
        padding: 20px;
    }
    
    .revision-card {
        background: white;
        border-radius: 15px;
        padding: 30px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    
    .revision-header {
        text-align: center;
        margin-bottom: 30px;
    }
    
    .revision-header h2 {
        color: #2c3e50;
        margin-bottom: 15px;
    }
    
    .revision-counter {
        display: inline-block;
        padding: 12px 24px;
        background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        color: white;
        border-radius: 25px;
        font-weight: 600;
        font-size: 16px;
    }
    
    .info-box {
        background: #e3f2fd;
        border-left: 4px solid #2196F3;
        padding: 20px;
        border-radius: 8px;
        margin: 20px 0;
    }
    
    .info-box h4 {
        color: #1976d2;
        margin-bottom: 10px;
    }
    
    .info-box ul {
        margin: 10px 0 0 20px;
    }
    
    .form-group {
        margin-bottom: 25px;
    }
    
    .form-group label {
        display: block;
        font-weight: 600;
        color: #2c3e50;
        margin-bottom: 10px;
        font-size: 16px;
    }
    
    .form-group textarea {
        width: 100%;
        padding: 15px;
        border: 2px solid #e0e0e0;
        border-radius: 10px;
        font-size: 15px;
        font-family: inherit;
        resize: vertical;
        transition: border-color 0.3s;
    }
    
    .form-group textarea:focus {
        outline: none;
        border-color: #667eea;
    }
    
    .char-counter {
        text-align: right;
        color: #666;
        font-size: 14px;
        margin-top: 5px;
    }
    
    .warning-box {
        background: #fff3cd;
        border-left: 4px solid #ffc107;
        padding: 20px;
        border-radius: 8px;
        margin: 20px 0;
    }
    
    .warning-box h4 {
        color: #856404;
        margin-bottom: 10px;
    }
    
    .action-buttons {
        display: flex;
        gap: 15px;
        margin-top: 30px;
    }
    
    .btn-submit-revision {
        flex: 1;
        background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        color: white;
        border: none;
        padding: 15px;
        border-radius: 10px;
        font-size: 18px;
        font-weight: 600;
        cursor: pointer;
        transition: transform 0.2s;
    }
    
    .btn-submit-revision:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(245, 87, 108, 0.3);
    }
    
    .btn-submit-revision:disabled {
        background: #ccc;
        cursor: not-allowed;
        transform: none;
    }
    
    .btn-cancel {
        flex: 1;
        background: #e0e0e0;
        color: #666;
        border: none;
        padding: 15px;
        border-radius: 10px;
        font-size: 18px;
        font-weight: 600;
        cursor: pointer;
        text-decoration: none;
        display: flex;
        align-items: center;
        justify-content: center;
    }
</style>
{% endblock %}

{% block content %}
<div class="revision-container">
    <div class="revision-card">
        <div class="revision-header">
            <h2><i class="fas fa-edit"></i> Request Revision</h2>
            <p style="color: #666; margin-bottom: 15px;">{{ service_request.title }}</p>
            <div class="revision-counter">
                <i class="fas fa-redo"></i>
                {{ service_request.revision_count }} / {{ service_request.max_revisions }} Revisions Used
                <br>
                <small>{{ remaining_revisions }} Remaining</small>
            </div>
        </div>

        <div class="info-box">
            <h4><i class="fas fa-lightbulb"></i> Revision Request Guidelines</h4>
            <ul>
                <li>Be specific about what needs to be changed</li>
                <li>Provide clear instructions and examples if possible</li>
                <li>Reference specific deliverables that need revision</li>
                <li>Keep feedback constructive and professional</li>
            </ul>
        </div>

        {% if remaining_revisions == 1 %}
        <div class="warning-box">
            <h4><i class="fas fa-exclamation-triangle"></i> Last Revision!</h4>
            <p style="margin: 0;">This is your final revision. After this, you must either approve the work or open a dispute.</p>
        </div>
        {% endif %}

        <form method="POST" id="revisionForm">
            {% csrf_token %}
            
            <div class="form-group">
                <label for="revision_notes">
                    <i class="fas fa-comment-dots"></i> What needs to be changed? *
                </label>
                <textarea 
                    name="revision_notes" 
                    id="revision_notes" 
                    rows="8" 
                    required 
                    minlength="20"
                    placeholder="Please provide detailed instructions on what needs to be revised...&#10;&#10;Example:&#10;- The logo needs to be larger and centered&#10;- Change the color scheme from blue to green&#10;- Add more detailed explanations in section 3"
                    oninput="updateCharCount()"
                ></textarea>
                <div class="char-counter" id="charCounter">0 / 20 characters minimum</div>
            </div>

            <div class="action-buttons">
                <a href="{% url 'requests:request_detail' service_request.id %}" class="btn-cancel">
                    <i class="fas fa-times"></i> Cancel
                </a>
                <button type="submit" class="btn-submit-revision" id="submitBtn">
                    <i class="fas fa-paper-plane"></i> Submit Revision Request
                </button>
            </div>
        </form>

        <p style="text-align: center; margin-top: 20px; color: #666;">
            Happy with the work? 
            <a href="{% url 'transactions:approve_work' service_request.id %}" style="color: #28a745;">
                Approve and release payment
            </a>
        </p>
    </div>
</div>

<script>
function updateCharCount() {
    const textarea = document.getElementById('revision_notes');
    const counter = document.getElementById('charCounter');
    const submitBtn = document.getElementById('submitBtn');
    const length = textarea.value.length;
    
    counter.textContent = length + ' / 20 characters minimum';
    
    if (length >= 20) {
        counter.style.color = '#28a745';
        submitBtn.disabled = false;
    } else {
        counter.style.color = '#dc3545';
        submitBtn.disabled = true;
    }
}

// Initialize
updateCharCount();
</script>
{% endblock %}
